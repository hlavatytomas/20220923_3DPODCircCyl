\section{Proper orthogonal decomposition}
\label{sec:POD}

{The proper orthogonal decomposition (POD) is a robust method identifying high-energy coherent structures in spatio-temporal data. Consequently, POD is often applied in the fields of turbulence analysis \citep{uruba2020,taira2020} and modeling \citep{gatski1991,shinde2020}. As a purely data-driven technique, it can be readily used to analyze both experimental and numerical data.}

%~ One of the possible applications of the proper orthogonal decomposition (POD) lies in identification of high-energy coherent structures in spatio-temporal data. Consequently, POD is often applied in the fields of turbulence analysis \citep{uruba2020,taira2020} and modeling \citep{gatski1991,shinde2020}. Simultaneously, POD is a purely data-driven and robust method and as such, it can be readily used to analyze both experimental and numerical data.


% {====ONLY COPY-PASTE=====}

Both the experimental and simulation data are generated by sampling the studied system at given times,
\begin{equation}
\label{eq:snapshots}
    \bm{S} = \left\{\bm{y}_{j}:=\bm{y}(t_{j}) \right\}_{j=1}^{n}\,,\quad t_{j}\in (0,T]\,,
\end{equation}
where $\bm{S}$ is a set of system \textit{snapshots} and $\bm{y}_{j}$ is the vector of data at time $t_{j}$.

If all the system snapshots have the same dimension, i.e. $\bm{y}_{j}\in\mathbb{R}^{m}\,,j=1,\dots,n$, the set $\bm{S}$ may be rearranged into the matrix of snapshots
\begin{equation}
\label{eq:matrixOfSnapshots}
    Y = \left[\bm{y}_{1},\dots,\bm{y}_{n}\right] \in \mathbb{R}^{m\times n}\,,\quad \mathrm{rank}\,(Y) = n\,\,
\end{equation}
where we assumed that the number of system snapshots $n$ is lower than the data dimension $m$, which is commonly true for both the experimental and numerical data.

The standard POD algorithms are based on the singular value decomposition (SVD) of the matrix $Y$. 
\begin{equation}
\label{eq:svdY}
\begin{array}{*1{>{\displaystyle}c}}
    Y = \Psi \Sigma \Phi^{\transp}\,,\Psi \in \mathbb{R}^{m\times m}, \Phi\in\mathbb{R}^{n\times n}, \Sigma = \mathrm{diag}\,(\sigma_{1},\dots,\sigma_{m}) \in \mathbb{R}^{m\times n}\\[0.3cm]
    \Psi\Psi^{\transp} = E_{m}\,,\,\Phi\Phi^{T} = E_{n}\,,\,\sigma_{1}\geq\sigma_{2}\geq\dots\geq\sigma_{n} > 0 = \sigma_{n+1} = \dots = \sigma_{m}
\end{array}    
\end{equation}
where $E_{m}$ and $E_{n}$ are identity matrices in $\mathbb{R}^{m\times m}$ and $\mathbb{R}^{n\times n}$, respectively, and the first $n$ columns of the matrix $\Psi$ form an orthonormal basis of the column space of the matrix $Y$, i.e.
\begin{equation}
\label{eq:chronosTopos}
    \bm{y}_{j} = \Psi_{n}\bm{\eta}_{j}\,,\quad H = \left[\bm{\eta}_{1},\dots,\bm{\eta}_{n}\right]:= \Psi_{n}^{\transp} Y\,,\,\Psi_{n} = \left[\bm{\psi}_{1},\dots,\bm{\psi}_{n} \right]\in\mathbb{R}^{m\times n}\,.
\end{equation}
In~\eqref{eq:chronosTopos}, each column $\bm{\psi}_{j},\,j=1,\dots,n$ of the matrix $\Psi_{n}$ represents a temporally coherent spatial structure, \textit{topos}. Furthermore, at any time $t_{j}$, the corresponding data vector $\bm{y}_{j}$ may be reconstructed as a linear combination of toposes, utilizing the coefficients $\bm{\eta}_{j}$. Thus, each row $j$ of the matrix $H\in\mathbb{R}^{n\times n}$ represents the temporal evolution of the contribution of the topos $\bm{\psi}_{j}$ to the reconstruction of the vector $\bm{y}_{j}$, \textit{chronos}.

Finally, let us note that given the SVD properties, the toposes are sorted in descending order by the amount of variance in the original data they represent. In particular, if the data $\bm{y}_{j},\,j=1,\dots,n$ correspond to the flow velocity field fluctuations $\bm{u}' = \bm{u} - \mathrm{mean}(\bm{u})$, the POD modes are ordered by the amount of the total turbulent kinetic energy they hold. The importance of each topos $\bm{\psi}_{j}$ is proportional to the corresponding singular value $\sigma_{j}$.

\paragraph{Computational remark:} The standard approach to POD analysis is to first compute the full matrix $\Psi_{n}$ and to subsequently truncate {it} as $\Psi_{\ell} = [\bm{\psi}_{1},\dots,\bm{\psi}_{\ell}]\in\mathbb{R}^{m\times \ell},\,{\ell < n,}$ based on a cut-off energy level, i.e. the error in the Frobenius norm in the $Y$ matrix reconstruction \citep{isoz2019,volkwein2013}.  However, such a task usually requires the matrix $Y$ to be loaded into the computer memory, which may prove {to be} a problem when processing a fully three-dimensional LES simulation data \citep{kabir2017}.

\begin{algorithm}[H]
    \centering
    \caption{Out-of-memory randomized POD modes computation}
    \label{alg:randPOD}
    \begin{algorithmic}[1]
    	\Require{matrix of snapshots $Y$, POD rank $\ell$, number of power iterations $r$}
        \State Generate Gaussian random $P\in\mathbb{R}^{n\times \ell}$
        \State Compute $\tilde{Y} := YP \in\mathbb{R}^{m\times \ell}$\label{alg:tildeYComp}
        \For{$k = 1 \, \mathbf{to} \, r$}
        \State update $\tilde{Y}:= Y (Y^{\transp}\tilde{Y})$\label{alg:tildeYUpdate}
        \EndFor
        \State Decompose $\tilde{Y} = QR\rightarrow Q\in\mathbb{R}^{m\times \ell}$
        \State Compute $B = Q^{\transp}Y\in\mathbb{R}^{\ell\times n}$\label{alg:BComp}
        \State Compute $\tilde{\Psi}_{\ell},\Sigma_{\ell},\Phi_{\ell} = \mathrm{svd}\,(B)$
        \Statex\Return $\Psi_{\ell} = Q\tilde{\Psi}_{\ell},\Sigma_{\ell},\Phi_{\ell}$
    \end{algorithmic}
\end{algorithm}
In order to limit the memory demands of POD modes computation, we employed an out-of-memory randomized SVD algorithm stemming from the works \citep{rokhlin2009,halko2011,gu2015}. Utilizing this approach, the number of modes of interest $\ell \ll n = \mathrm{rank}\,(Y)$ needs to be known a-priori. The POD modes computation is based on a generation of a Gaussian random matrix $P\in\mathbb{R}^{n\times \ell}$ and summarized in Algorithm~\ref{alg:randPOD}. Note that all the computations involving the original matrix $Y$, i.e. the lines~\ref{alg:tildeYComp}, \ref{alg:tildeYUpdate} and~\ref{alg:BComp} of Algorithm~\ref{alg:randPOD} may be decomposed into a series of outer vector products and the matrix $Y$ does not have to be fully loaded into the computer memory.

% {====ONLY COPY-PASTE(END)=====}

\begin{figure}[htbp]
    \centering
    % \includegraphics[width=1.0\textwidth]{example-image-golden}
    % \input{\myGraphs/compPOD_rndPOD.tex}
    \includegraphics[width=0.98\textwidth]{02_images/00_export/figure4.png}
    \caption{POD and randomized POD (rPOD) results for simulated velocity field sampled on PoM1. (a) $\bm{\psi}_{1,x}$ computed via POD, (b) relative difference between the POD and rPOD toposes, (c) $_{\mathrm{r}}\bm{\psi}_{1,x}$ computed via rPOD, (d) relative difference between the first 30 POD and rPOD singular values.}
    \label{fig:podRandPODComp}
\end{figure}
In Figures~\ref{fig:podRandPODComp}a and~\ref{fig:podRandPODComp}c, we show the most energetic modes obtained via POD and randomized POD (rPOD) analysis of the simulated velocity data on PoM1, respectively. In Figure~\ref{fig:podRandPODComp}b, the relative error between the two datasets is depicted. Finally, note that the randomized POD variant was performed with $\ell = 30$. In Figure~\ref{fig:podRandPODComp}d, we compare the $\ell$ singular values $\sigma_{\ell}$ obtained via the standard and the randomized POD variant. Altogether, the data depicted in Figure~\ref{fig:podRandPODComp} show that from the point of view of the simulated system analysis, there is no perceivable difference between POD and rPOD.
